<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Кастомное название и описание. Голубой алмаз</title>
    <meta name="description" content="Алмаз Хоупа — крупный бриллиант массой в 45,52 карата глубокого сапфирово-синего цвета. Находится в экспозиции Музея естественной истории при Смитсоновском институте в Вашингтоне (США)."/>
    <meta property = "og:image" content="http://www.finfortit.com/wp-content/uploads/2016/02/1702162.jpg"/>
    <script src="https://podtelkin.github.io/js/oksdk.js"></script>
</head>
<body>

<br>
<input type="button" value="OKSDK.post user new" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_USER);">
<br><br>
<input type="button" value="OKSDK.post user old" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_USER, true);">
<br><br>
<input type="button" value="OKSDK.post user new LINK" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_USER_LINK);">
<br><br>
<input type="button" value="OKSDK.post user old LINK" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_USER_LINK, true);">
<br><br>
<input type="button" value="OKSDK.post group new" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_GROUP);">
<br><br>
<input type="button" value="OKSDK.post group old" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_GROUP, true);">
<br><br>
<input type="button" value="ask GROUP_BOT_API_TOKEN" onclick="OKSDK.Widgets.askGroupAppPermissions('GROUP_BOT_API_TOKEN', RETURN_URL);">
<br><br>
<input type="button" value="ask MESSAGES_FROM_GROUP" onclick="OKSDK.Widgets.askGroupAppPermissions('MESSAGES_FROM_GROUP', RETURN_URL);">
<br><br>
<input type="button" value="PRINT PARAMS" onclick="printParams();">
<br><br>

<div id="hello" style="background: #AFA;">
<b>PROGRAM LOG:</b><br><br>
</div>

<script>
    print = function(msg) {
       var h = document.getElementById('hello');
       if (h) h.innerHTML += msg + '<br>';
    }

    print('[STAGE 1] - START');

    var config = {
        app_id: 1250488320,
        groupId: 53615552233562, 
        app_key: 'CBABPJILEBABABABA',
        widget_server: 'https://test.ok.ru/',
        api_server: 'https://apitest.ok.ru/'
    };

    RETURN_URL = 'https://podtelkin.github.io/return.html';

    print('widget_server: ' + config.widget_server);
    print('api_server: ' + config.api_server);

    printParams = function() {
        var params = OKSDK.Util.getRequestParameters();
        var pageinfo = document.getElementById('pageinfo');
        print('custom_args: ' + params['custom_args']);
    };

    API_callback = function(method, result, data) {
        print('METHOD: ' + method);
        print('RESULT: ' + result);
        print('DATA  : ' + data); 
    };

    ATTACHMENT = {
        'media' : [
            {'type': 'text', 'text': 'hello world!'}
        ]
    };

    ATTACHMENT_LINK = {
        'media' : [
            {'type': 'text', 'text': 'hello world!'},
            {'type': 'link', 
             'url': 'https://ok.ru/group/53615552233562/app/1250488320?AAAAAAAAAAAAAAAA=BBBBBBBBBBB', 
             'imageUrl' : 'http://proxy11.media.online.ua/uol/r2-9496695a74/56246f7eabb43.jpg',
             'buttonKey' : 'LISTEN'
            }
        ]
    };

    TOPIC_USER = ATTACHMENT; 
    TOPIC_USER_LINK = ATTACHMENT_LINK; 

    TOPIC_GROUP = {
        'attachment' : ATTACHMENT_LINK,
        'groupId' : config.groupId
    };

    click_post = function() {
        OKSDK.REST.call(
            'mediatopic.post',  
            {
                'type' : 'GROUP_THEME',
                'gid' : config.groupId,
                'attachment' : JSON.stringify(ATTACHMENT)
            }, 
            function (status, data, error) { 
                console.log('mediatopic.post result(status=' + status + ', data=' + data + ', error=' + error);
                if (error) {
                    console.log(error.error_code + ', msg: ' + error.error_msg);
                } 
        });
    };


    print('[STAGE 2] - OKSDK inting...');

    OKSDK.init(config, function () {
        print('OKSDK.init success');
    }, function (error) {
        print('OKSDK.init error: ' + error);
    });


    print('[STAGE 3] - OKSDK.Util.addExternalLinksListener...');

    OKSDK.Util.addExternalLinksListener();

    print('[OK] - DONE');

</script>

<br><br><a href="https://m.lenta.ru" target="_blank">simple link</a>
<br><br><a href="https://m.lenta.ru" class="js-ok-extlink" target="_blank">extlink with class</a>
<br><br><a href="javascript:OKSDK.Util.openAppExternalLink('https://m.lenta.ru');" target="_blank">extlink with js</a>

<br><br>
capture=camera:<br>
<input type="file" accept="image/*;capture=camera"/><br>

capture=camcorder:<br>
<input type="file" accept="video/*;capture=camcorder"><br>

capture=microphone:<br>
<input type="file" accept="audio/*;capture=microphone"><br>

</body>
</html>
