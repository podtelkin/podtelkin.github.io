<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Кастомное название и описание. Голубой алмаз</title>
    <meta name="description" content="Алмаз Хоупа — крупный бриллиант массой в 45,52 карата глубокого сапфирово-синего цвета. Находится в экспозиции Музея естественной истории при Смитсоновском институте в Вашингтоне (США)."/>
    <meta property = "og:image" content="http://www.finfortit.com/wp-content/uploads/2016/02/1702162.jpg"/>
    <script src="https://podtelkin.github.io/js/oksdk.js"></script>
</head>
<body>

<br>
<input type="button" value="OKSDK.post user new" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_USER);">
&nbsp;
<input type="button" value="OKSDK.post user old" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_USER, true);">
<br><br>
<input type="button" value="OKSDK.post user new LINK" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_USER_LINK);">
&nbsp;
<input type="button" value="OKSDK.post user old LINK" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_USER_LINK, true);">
<br><br>
<input type="button" value="OKSDK.post group new" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_GROUP);">
&nbsp;
<input type="button" value="OKSDK.post group old" onclick="OKSDK.Widgets.post(RETURN_URL, TOPIC_GROUP, true);">
<br><br>
<input type="button" value="ask GROUP_BOT_API_TOKEN" onclick="OKSDK.Widgets.askGroupAppPermissions('GROUP_BOT_API_TOKEN', RETURN_URL);">
&nbsp;
<input type="button" value="ask MESSAGES_FROM_GROUP" onclick="OKSDK.Widgets.askGroupAppPermissions('MESSAGES_FROM_GROUP', RETURN_URL);">
<br><br>
<input type="button" value="ask GROUP_CONTENT" onclick="OKSDK.Widgets.askUserAppPermissions('GROUP_CONTENT', RETURN_URL);">
<br><br>
<input type="button" value="PRINT PARAMS" onclick="printParams();">
<br><br>
<a href="tel:+79052301402">Позвони мне</a>
<br><br>
<button onclick="document.location.href='tel:+79052301402';">Позвони мне через JS</button>
<br><br>

<div id="hello" style="background: #AFA;">
<b>PROGRAM LOG:</b><br><br>
</div>

<script>
    print = function(msg) {
       var h = document.getElementById('hello');
       if (h) h.innerHTML += msg + '<br>';
    }

    print('[STAGE 1] - START');

    var config = {
        app_id: 1250488320,
        groupId: 53615552233562, 
        app_key: 'CBABPJILEBABABABA',
        widget_server: 'https://test.ok.ru/',
        api_server: 'https://apitest.ok.ru/'
    };

    RETURN_URL = 'https://podtelkin.github.io/return.html';

    print('widget_server: ' + config.widget_server);
    print('api_server: ' + config.api_server);

    printParams = function() {
        var params = OKSDK.Util.getRequestParameters();
        var pageinfo = document.getElementById('pageinfo');
        print('custom_args: ' + params['custom_args']);
    };

    API_callback = function(method, result, data) {
        print('METHOD: ' + method);
        print('RESULT: ' + result);
        print('DATA  : ' + data); 
    };

    ATTACHMENT = {
        'media' : [
            {'type': 'text', 'text': 'hello world!'}
        ]
    };

    ATTACHMENT_LINK = {
        'media' : [
            {'type': 'text', 'text': 'hello world!'},
            {'type': 'link', 
             'url': 'https://ok.ru/group/53615552233562/app/1250488320?AAAAAAAAAAAAAAAA=BBBBBBBBBBB', 
             'imageUrl' : 'http://proxy11.media.online.ua/uol/r2-9496695a74/56246f7eabb43.jpg',
             'buttonKey' : 'LISTEN'
            }
        ]
    };

    TOPIC_USER = ATTACHMENT; 
    TOPIC_USER_LINK = ATTACHMENT_LINK; 

    TOPIC_GROUP = {
        'attachment' : ATTACHMENT_LINK,
        'groupId' : config.groupId
    };

    click_post = function() {
        OKSDK.REST.call(
            'mediatopic.post',  
            {
                'type' : 'GROUP_THEME',
                'gid' : config.groupId,
                'attachment' : JSON.stringify(ATTACHMENT)
            }, 
            function (status, data, error) { 
                console.log('mediatopic.post result(status=' + status + ', data=' + data + ', error=' + error);
                if (error) {
                    console.log(error.error_code + ', msg: ' + error.error_msg);
                } 
        });
    };


    print('[STAGE 2] - OKSDK inting...');

    OKSDK.init(config, function () {
        print('OKSDK.init success');
    }, function (error) {
        print('OKSDK.init error: ' + error);
    });


    print('[STAGE 3] - OKSDK.Util.addExternalLinksListener...');

    OKSDK.Util.addExternalLinksListener();

    print('[OK] - DONE');

    var params = OKSDK.Util.getRequestParameters(window.location.search);

    print('custom_args = ' + params['custom_args']);


</script>

<br><br><a href="https://m.lenta.ru" target="_blank">simple link</a>
<br><br><a href="https://m.lenta.ru" class="js-ok-extlink" target="_blank">extlink with class</a>
<br><br><a href="javascript:OKSDK.Util.openAppExternalLink('https://m.lenta.ru');" target="_blank">extlink with js</a>
<br><br>
WebRTC:<br>
<div class="demo-wrapper">
	<video id="video" width="640" height="480" autoplay="" src="blob:https://davidwalsh.name/ae513d31-1a9f-490f-9496-c8b602a212fc"></video>
	<button id="snap" class="sexyButton">Snap Photo</button>
	<canvas id="canvas" width="640" height="480"></canvas>

	<script>
           print('Loading WebRTC...');

		// Put event listeners into place
		window.addEventListener("DOMContentLoaded", function() {
			// Grab elements, create settings, etc.
            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');
            var video = document.getElementById('video');
            var mediaConfig =  { video: true };
            var errBack = function(e) {
            	console.log('An error has occurred!', e)
            };

			// Put video listeners into place
            if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                print('WebRTC - [NEW]');
                navigator.mediaDevices.getUserMedia(mediaConfig).then(function(stream) {
                    video.src = window.URL.createObjectURL(stream);
                    video.play();
                });
            }

            /* Legacy code below! */
            else if(navigator.getUserMedia) { // Standard
                                print('WebRTC - [Standard]');
				navigator.getUserMedia(mediaConfig, function(stream) {
					video.src = stream;
					video.play();
				}, errBack);
			} else if(navigator.webkitGetUserMedia) { // WebKit-prefixed
                                print('WebRTC - [WebKit-prefixed]');
				navigator.webkitGetUserMedia(mediaConfig, function(stream){
					video.src = window.webkitURL.createObjectURL(stream);
					video.play();
				}, errBack);
			} else if(navigator.mozGetUserMedia) { // Mozilla-prefixed
                                print('WebRTC - [Mozilla-prefixed]');
				navigator.mozGetUserMedia(mediaConfig, function(stream){
					video.src = window.URL.createObjectURL(stream);
					video.play();
				}, errBack);
			}

			// Trigger photo take
			document.getElementById('snap').addEventListener('click', function() {
				context.drawImage(video, 0, 0, 640, 480);
			});
		}, false);

	</script>

</div>

</body>
</html>
